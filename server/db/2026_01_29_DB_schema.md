## List of relations

Schema | Name | Type | Owner  
--------+--------------------+-------+----------
public | achievements | table | postgres
public | card_flags | table | postgres
public | cards | table | postgres
public | daily_challenges | table | postgres
public | daily_progress | table | postgres
public | deck_flags | table | postgres
public | deck_reviews | table | postgres
public | decks | table | postgres
public | refresh_tokens | table | postgres
public | study_sessions | table | postgres
public | subjects | table | postgres
public | user_achievements | table | postgres
public | user_card_progress | table | postgres
public | users | table | postgres

### Table "public.achievements"

     Column      |           Type           | Collation | Nullable |           Default

-----------------+--------------------------+-----------+----------+-----------------------------
id | character varying(50) | | not null |
title | character varying(100) | | not null |
description | text | | not null |
icon | character varying(50) | | not null |
color | character varying(100) | | not null |
xp_reward | integer | | | 0
condition_type | character varying(50) | | not null |
condition_value | integer | | not null |
tier | character varying(20) | | | 'bronze'::character varying
created_at | timestamp with time zone | | | now()
Indexes:
"achievements_pkey" PRIMARY KEY, btree (id)
Referenced by:
TABLE "user_achievements" CONSTRAINT "user_achievements_achievement_id_fkey" FOREIGN KEY (achievement_id) REFERENCES achievements(id)

### Table "public.card_flags"

       Column        |           Type           | Collation | Nullable |        Default

---------------------+--------------------------+-----------+----------+------------------------
id | uuid | | not null | uuid_generate_v4()
card_id | uuid | | not null |
deck_id | uuid | | not null |
flagged_by_user_id | uuid | | not null |
comment | text | | |
status | flag_status | | | 'pending'::flag_status
reviewed_by_user_id | uuid | | |
reviewed_at | timestamp with time zone | | |
review_notes | text | | |
created_at | timestamp with time zone | | | now()
updated_at | timestamp with time zone | | | now()
Indexes:
"card_flags_pkey" PRIMARY KEY, btree (id)
"idx_card_flags_card" btree (card_id)
"idx_card_flags_deck" btree (deck_id)
"idx_card_flags_pending" btree (created_at DESC) WHERE status = 'pending'::flag_status
"idx_card_flags_reviewer" btree (reviewed_by_user_id) WHERE reviewed_by_user_id IS NOT NULL
"idx_card_flags_status" btree (status)
"idx_card_flags_user" btree (flagged_by_user_id)
Foreign-key constraints:
"card_flags_card_id_fkey" FOREIGN KEY (card_id) REFERENCES cards(id) ON DELETE CASCADE
"card_flags_deck_id_fkey" FOREIGN KEY (deck_id) REFERENCES decks(id) ON DELETE CASCADE
"card_flags_flagged_by_user_id_fkey" FOREIGN KEY (flagged_by_user_id) REFERENCES users(id) ON DELETE CASCADE
"card_flags_reviewed_by_user_id_fkey" FOREIGN KEY (reviewed_by_user_id) REFERENCES users(id) ON DELETE SET NULL
Triggers:
card_flags_updated_at BEFORE UPDATE ON card_flags FOR EACH ROW EXECUTE FUNCTION update_card_flags_updated_at()
update_card_flag_count_trigger AFTER INSERT OR DELETE OR UPDATE ON card_flags FOR EACH ROW EXECUTE FUNCTION update_card_flag_count()

### Table "public.cards"

         Column         |           Type           | Collation | Nullable |        Default

------------------------+--------------------------+-----------+----------+-----------------------
id | uuid | | not null | uuid_generate_v4()
deck_id | uuid | | not null |
front | text | | not null |
back | text | | not null |
context | text | | |
hint | text | | |
type | card_type | | | 'standard'::card_type
options | text[] | | |
created_at | timestamp with time zone | | | now()
updated_at | timestamp with time zone | | | now()
created_by | uuid | | |
position | integer | | | 0
deleted_at | timestamp with time zone | | |
flag_count | integer | | | 0
correct_option_indices | integer[] | | |
Indexes:
"cards_pkey" PRIMARY KEY, btree (id)
"idx_cards_deck" btree (deck_id)
Foreign-key constraints:
"cards_created_by_fkey" FOREIGN KEY (created_by) REFERENCES users(id)
"cards_deck_id_fkey" FOREIGN KEY (deck_id) REFERENCES decks(id) ON DELETE CASCADE
Referenced by:
TABLE "card_flags" CONSTRAINT "card_flags_card_id_fkey" FOREIGN KEY (card_id) REFERENCES cards(id) ON DELETE CASCADE
TABLE "user_card_progress" CONSTRAINT "user_card_progress_card_id_fkey" FOREIGN KEY (card_id) REFERENCES cards(id) ON DELETE CASCADE
Triggers:
update_deck_total_cards_trigger AFTER INSERT OR DELETE OR UPDATE ON cards FOR EACH ROW EXECUTE FUNCTION update_deck_total_cards()

### Table "public.daily_challenges"

           Column           |           Type           | Collation | Nullable |      Default

----------------------------+--------------------------+-----------+----------+--------------------
id | uuid | | not null | uuid_generate_v4()
user_id | uuid | | not null |
date | date | | not null |
cards_learned_today | integer | | | 0
time_studied_today | integer | | | 0
streak_maintained | boolean | | | false
cards_target | integer | | | 30
time_target | integer | | | 20
cards_challenge_completed | boolean | | | false
time_challenge_completed | boolean | | | false
streak_challenge_completed | boolean | | | false
cards_reward_claimed | boolean | | | false
time_reward_claimed | boolean | | | false
streak_reward_claimed | boolean | | | false
created_at | timestamp with time zone | | | now()
updated_at | timestamp with time zone | | | now()
Indexes:
"daily_challenges_pkey" PRIMARY KEY, btree (id)
"idx_daily_challenges_user_date" btree (user_id, date DESC)
"unique_user_daily_challenge" UNIQUE CONSTRAINT, btree (user_id, date)
Foreign-key constraints:
"daily_challenges_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE

### Table "public.daily_progress"

       Column       |  Type   | Collation | Nullable |      Default

--------------------+---------+-----------+----------+--------------------
id | uuid | | not null | uuid_generate_v4()
user_id | uuid | | not null |
date | date | | not null |
cards_studied | integer | | | 0
cards_learned | integer | | | 0
time_spent_minutes | integer | | | 0
xp_earned | integer | | | 0
sessions_completed | integer | | | 0
Indexes:
"daily_progress_pkey" PRIMARY KEY, btree (id)
"unique_daily_progress" UNIQUE CONSTRAINT, btree (user_id, date)
Foreign-key constraints:
"daily_progress_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE

### Table "public.deck_flags"

       Column        |           Type           | Collation | Nullable |        Default

---------------------+--------------------------+-----------+----------+------------------------
id | uuid | | not null | uuid_generate_v4()
deck_id | uuid | | not null |
flagged_by_user_id | uuid | | not null |
reason | character varying(100) | | |
comment | text | | |
status | flag_status | | | 'pending'::flag_status
reviewed_by_user_id | uuid | | |
reviewed_at | timestamp with time zone | | |
review_notes | text | | |
created_at | timestamp with time zone | | | now()
updated_at | timestamp with time zone | | | now()
Indexes:
"deck_flags_pkey" PRIMARY KEY, btree (id)
"idx_deck_flags_deck" btree (deck_id)
"idx_deck_flags_pending" btree (created_at DESC) WHERE status = 'pending'::flag_status
"idx_deck_flags_reason" btree (reason)
"idx_deck_flags_reviewer" btree (reviewed_by_user_id) WHERE reviewed_by_user_id IS NOT NULL
"idx_deck_flags_status" btree (status)
"idx_deck_flags_user" btree (flagged_by_user_id)
Foreign-key constraints:
"deck_flags_deck_id_fkey" FOREIGN KEY (deck_id) REFERENCES decks(id) ON DELETE CASCADE
"deck_flags_flagged_by_user_id_fkey" FOREIGN KEY (flagged_by_user_id) REFERENCES users(id) ON DELETE CASCADE
"deck_flags_reviewed_by_user_id_fkey" FOREIGN KEY (reviewed_by_user_id) REFERENCES users(id) ON DELETE SET NULL
Triggers:
deck_flags_updated_at BEFORE UPDATE ON deck_flags FOR EACH ROW EXECUTE FUNCTION update_deck_flags_updated_at()
update_deck_flag_count_trigger AFTER INSERT OR DELETE OR UPDATE ON deck_flags FOR EACH ROW EXECUTE FUNCTION update_deck_flag_count()

### Table "public.deck_reviews"

Column | Type | Collation | Nullable | Default  
------------+--------------------------+-----------+----------+--------------------
id | uuid | | not null | uuid_generate_v4()
deck_id | uuid | | not null |
user_id | uuid | | not null |
rating | integer | | not null |
comment | text | | |
created_at | timestamp with time zone | | | now()
updated_at | timestamp with time zone | | | now()
Indexes:
"deck_reviews_pkey" PRIMARY KEY, btree (id)
"idx_deck_reviews_created" btree (created_at DESC)
"idx_deck_reviews_deck" btree (deck_id)
"idx_deck_reviews_rating" btree (rating)
"idx_deck_reviews_user" btree (user_id)
"unique_user_deck_review" UNIQUE CONSTRAINT, btree (deck_id, user_id)
Check constraints:
"deck_reviews_rating_check" CHECK (rating >= 1 AND rating <= 5)
Foreign-key constraints:
"deck_reviews_deck_id_fkey" FOREIGN KEY (deck_id) REFERENCES decks(id) ON DELETE CASCADE
"deck_reviews_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Triggers:
deck_reviews_updated_at BEFORE UPDATE ON deck_reviews FOR EACH ROW EXECUTE FUNCTION update_deck_reviews_updated_at()
update_deck_stats_on_review_change AFTER INSERT OR DELETE OR UPDATE ON deck_reviews FOR EACH ROW EXECUTE FUNCTION update_deck_rating_stats()

### Table "public.decks"

     Column     |           Type           | Collation | Nullable |        Default

----------------+--------------------------+-----------+----------+------------------------
id | uuid | | not null | uuid_generate_v4()
title | character varying(200) | | not null |
description | text | | |
subject_id | character varying(50) | | |
topic | character varying(200) | | |
difficulty | difficulty_level | | | 'A2'::difficulty_level
cover_image | character varying(500) | | |
is_public | boolean | | | true
tags | text[] | | | '{}'::text[]
total_cards | integer | | | 0
owner_id | uuid | | not null |
created_at | timestamp with time zone | | | now()
updated_at | timestamp with time zone | | | now()
last_studied | timestamp with time zone | | |
sync_status | sync_status | | | 'synced'::sync_status
version | integer | | | 1
deleted_at | timestamp with time zone | | |
average_rating | numeric(3,2) | | | 0.00
review_count | integer | | | 0
flag_count | integer | | | 0
Indexes:
"decks_pkey" PRIMARY KEY, btree (id)
"idx_decks_owner" btree (owner_id)
Foreign-key constraints:
"decks_owner_id_fkey" FOREIGN KEY (owner_id) REFERENCES users(id) ON DELETE CASCADE
"decks_subject_id_fkey" FOREIGN KEY (subject_id) REFERENCES subjects(id)
Referenced by:
TABLE "card_flags" CONSTRAINT "card_flags_deck_id_fkey" FOREIGN KEY (deck_id) REFERENCES decks(id) ON DELETE CASCADE
TABLE "cards" CONSTRAINT "cards_deck_id_fkey" FOREIGN KEY (deck_id) REFERENCES decks(id) ON DELETE CASCADE
TABLE "deck_flags" CONSTRAINT "deck_flags_deck_id_fkey" FOREIGN KEY (deck_id) REFERENCES decks(id) ON DELETE CASCADE
TABLE "deck_reviews" CONSTRAINT "deck_reviews_deck_id_fkey" FOREIGN KEY (deck_id) REFERENCES decks(id) ON DELETE CASCADE
TABLE "study_sessions" CONSTRAINT "study_sessions_deck_id_fkey" FOREIGN KEY (deck_id) REFERENCES decks(id) ON DELETE SET NULL

### Table "public.refresh_tokens"

Column | Type | Collation | Nullable | Default  
------------+--------------------------+-----------+----------+--------------------
id | uuid | | not null | uuid_generate_v4()
user_id | uuid | | not null |
token_hash | character varying(255) | | not null |
expires_at | timestamp with time zone | | not null |
created_at | timestamp with time zone | | | now()
revoked_at | timestamp with time zone | | |
Indexes:
"refresh_tokens_pkey" PRIMARY KEY, btree (id)
"unique_token" UNIQUE CONSTRAINT, btree (token_hash)
Foreign-key constraints:
"refresh_tokens_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE

### Table "public.study_sessions"

       Column       |           Type           | Collation | Nullable |           Default

--------------------+--------------------------+-----------+----------+-----------------------------
id | uuid | | not null | uuid_generate_v4()
user_id | uuid | | |
deck_id | uuid | | |
title | character varying(200) | | |
selection_method | character varying(20) | | not null |
total_cards | integer | | not null |
selected_card_ids | uuid[] | | not null |
current_card_index | integer | | | 0
answers | jsonb | | | '{}'::jsonb
streak | integer | | | 0
session_xp | integer | | | 0
status | character varying(20) | | | 'active'::character varying
started_at | timestamp with time zone | | | now()
completed_at | timestamp with time zone | | |
last_activity_at | timestamp with time zone | | | now()
duration_seconds | integer | | |
score | integer | | |
correct_count | integer | | | 0
incorrect_count | integer | | | 0
skipped_count | integer | | | 0
created_at | timestamp with time zone | | | now()
updated_at | timestamp with time zone | | | now()
guest_token | character varying(255) | | |
is_guest | boolean | | | false
Indexes:
"study_sessions_pkey" PRIMARY KEY, btree (id)
"idx_study_sessions_active" btree (user_id, status) WHERE status::text = 'active'::text
"idx_study_sessions_deck" btree (deck_id)
"idx_study_sessions_guest_token" btree (guest_token)
"idx_study_sessions_last_activity" btree (user_id, last_activity_at DESC)
"idx_study_sessions_user_status" btree (user_id, status)
Check constraints:
"check_session_identity" CHECK (user_id IS NOT NULL OR guest_token IS NOT NULL)
Foreign-key constraints:
"study_sessions_deck_id_fkey" FOREIGN KEY (deck_id) REFERENCES decks(id) ON DELETE SET NULL
"study_sessions_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Triggers:
update_study_sessions_updated_at BEFORE UPDATE ON study_sessions FOR EACH ROW EXECUTE FUNCTION update_updated_at_column()

### Table "public.subjects"

Column | Type | Collation | Nullable | Default
------------+--------------------------+-----------+----------+---------
id | character varying(50) | | not null |
name | character varying(100) | | not null |
color | character varying(20) | | not null |
icon | character varying(50) | | not null |
created_at | timestamp with time zone | | | now()
Indexes:
"subjects_pkey" PRIMARY KEY, btree (id)
Referenced by:
TABLE "decks" CONSTRAINT "decks_subject_id_fkey" FOREIGN KEY (subject_id) REFERENCES subjects(id)

### Table "public.user_achievements"

     Column     |           Type           | Collation | Nullable |      Default

----------------+--------------------------+-----------+----------+--------------------
id | uuid | | not null | uuid_generate_v4()
user_id | uuid | | not null |
achievement_id | character varying(50) | | not null |
unlocked_at | timestamp with time zone | | | now()
xp_awarded | integer | | | 0
Indexes:
"user_achievements_pkey" PRIMARY KEY, btree (id)
"unique_user_achievement" UNIQUE CONSTRAINT, btree (user_id, achievement_id)
Foreign-key constraints:
"user_achievements_achievement_id_fkey" FOREIGN KEY (achievement_id) REFERENCES achievements(id)
"user_achievements_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE

### Table "public.user_card_progress"

      Column      |           Type           | Collation | Nullable |      Default

------------------+--------------------------+-----------+----------+--------------------
id | uuid | | not null | uuid_generate_v4()
user_id | uuid | | not null |
card_id | uuid | | not null |
status | card_status | | | 'new'::card_status
ease_factor | numeric(3,2) | | | 2.50
interval | integer | | | 0
repetitions | integer | | | 0
next_review_date | date | | |
times_seen | integer | | | 0
times_correct | integer | | | 0
times_incorrect | integer | | | 0
last_reviewed_at | timestamp with time zone | | |
created_at | timestamp with time zone | | | now()
updated_at | timestamp with time zone | | | now()
Indexes:
"user_card_progress_pkey" PRIMARY KEY, btree (id)
"idx_user_card_progress_card" btree (card_id)
"idx_user_card_progress_next_review" btree (user_id, next_review_date) WHERE next_review_date IS NOT NULL
"idx_user_card_progress_status" btree (user_id, status)
"idx_user_card_progress_user" btree (user_id)
"unique_user_card_progress" UNIQUE CONSTRAINT, btree (user_id, card_id)
Foreign-key constraints:
"user_card_progress_card_id_fkey" FOREIGN KEY (card_id) REFERENCES cards(id) ON DELETE CASCADE
"user_card_progress_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Triggers:
update_user_card_progress_updated_at BEFORE UPDATE ON user_card_progress FOR EACH ROW EXECUTE FUNCTION update_updated_at_column()

### Table "public.users"

        Column         |           Type           | Collation | Nullable |                                                     Default

-----------------------+--------------------------+-----------+----------+-----------------------------------------------------------------------------------------------------------------
id | uuid | | not null | uuid_generate_v4()
email | character varying(255) | | not null |
password_hash | character varying(255) | | not null |
name | character varying(100) | | not null |
avatar | character varying(500) | | |
role | user_role | | | 'student'::user_role
level | integer | | | 1
current_xp | integer | | | 0
next_level_xp | integer | | | 100
total_xp | integer | | | 0
streak | integer | | | 0
longest_streak | integer | | | 0
last_active_date | date | | |
total_time_spent | integer | | | 0
total_cards_learned | integer | | | 0
total_decks_completed | integer | | | 0
preferences | jsonb | | | '{"theme": "light", "language": "ro", "dailyGoal": 20, "soundEnabled": true, "animationsEnabled": true}'::jsonb
created_at | timestamp with time zone | | | now()
updated_at | timestamp with time zone | | | now()
last_login_at | timestamp with time zone | | |
deleted_at | timestamp with time zone | | |
total_correct_answers | integer | | | 0
total_answers | integer | | | 0
Indexes:
"users_pkey" PRIMARY KEY, btree (id)
"idx_users_email" btree (email)
"users_email_key" UNIQUE CONSTRAINT, btree (email)
Check constraints:
"check_answers_positive" CHECK (total_correct_answers >= 0 AND total_answers >= 0)
"check_correct_not_exceed_total" CHECK (total_correct_answers <= total_answers)
Referenced by:
TABLE "card_flags" CONSTRAINT "card_flags_flagged_by_user_id_fkey" FOREIGN KEY (flagged_by_user_id) REFERENCES users(id) ON DELETE CASCADE
TABLE "card_flags" CONSTRAINT "card_flags_reviewed_by_user_id_fkey" FOREIGN KEY (reviewed_by_user_id) REFERENCES users(id) ON DELETE SET NULL
TABLE "cards" CONSTRAINT "cards_created_by_fkey" FOREIGN KEY (created_by) REFERENCES users(id)
TABLE "daily_challenges" CONSTRAINT "daily_challenges_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
TABLE "daily_progress" CONSTRAINT "daily_progress_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
TABLE "deck_flags" CONSTRAINT "deck_flags_flagged_by_user_id_fkey" FOREIGN KEY (flagged_by_user_id) REFERENCES users(id) ON DELETE CASCADE
TABLE "deck_flags" CONSTRAINT "deck_flags_reviewed_by_user_id_fkey" FOREIGN KEY (reviewed_by_user_id) REFERENCES users(id) ON DELETE SET NULL
TABLE "deck_reviews" CONSTRAINT "deck_reviews_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
TABLE "decks" CONSTRAINT "decks_owner_id_fkey" FOREIGN KEY (owner_id) REFERENCES users(id) ON DELETE CASCADE
TABLE "refresh_tokens" CONSTRAINT "refresh_tokens_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
TABLE "study_sessions" CONSTRAINT "study_sessions_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
TABLE "user_achievements" CONSTRAINT "user_achievements_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
TABLE "user_card_progress" CONSTRAINT "user_card_progress_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
